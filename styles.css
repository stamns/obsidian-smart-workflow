/* Obsidian Smart Workflow Styles */

/* Animation for the title text effect - Shimmer effect */
@keyframes ai-shimmer {
    0% {
        background-position: -200% 0;
    }

    100% {
        background-position: 200% 0;
    }
}

.ai-generating-title {
    background: linear-gradient(90deg,
            var(--text-normal) 0%,
            var(--interactive-accent) 25%,
            var(--interactive-accent-hover) 50%,
            var(--interactive-accent) 75%,
            var(--text-normal) 100%);
    background-size: 200% auto;
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent !important;
    animation: ai-shimmer 2s linear infinite;
}

/* Fallback if background-clip not supported */
@supports not (background-clip: text) {
    .ai-generating-title {
        color: var(--interactive-accent) !important;
        text-shadow: 0 0 10px var(--interactive-accent);
    }
}

/* Settings Tab Navigation Styles */

/* 头部容器 */
.smart-workflow-settings-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    padding: 0 8px;
}

/* 标签页导航栏 */
.smart-workflow-tabs {
    display: flex;
    border-bottom: 1px solid var(--background-modifier-border);
    margin-bottom: 8px;
    padding: 0 4px;
}

/* 单个标签 */
.smart-workflow-tab {
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 4px 10px;
    cursor: pointer;
    border-bottom: 2px solid transparent;
    margin-bottom: -1px;
    color: var(--text-muted);
    transition: all 0.2s ease;
    background: transparent;
    border-left: none;
    border-right: none;
    border-top: none;
    font-size: 13px;
}

/* 标签悬停效果 */
.smart-workflow-tab:hover {
    color: var(--text-normal);
    background-color: var(--background-modifier-hover);
}

/* 激活的标签 */
.smart-workflow-tab.active {
    color: var(--text-accent);
    border-bottom-color: var(--text-accent);
}

/* 标签图标 */
.smart-workflow-tab-icon {
    font-size: 14px;
    line-height: 1;
}

/* 内容区域 */
.smart-workflow-content {
    padding: 0 4px;
    animation: fadeIn 0.2s ease;
}

/* 淡入动画 */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(4px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* 响应式布局 */
@media screen and (max-width: 1024px) {
    .smart-workflow-settings-header {
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }
}

/* ==================== Terminal Styles ==================== */

/* 工作区叶子内容 - 终端视图 */
.workspace-leaf-content[data-type="terminal-view"] {
    display: flex !important;
    flex-direction: column !important;
    padding: 0 !important;
    overflow: hidden !important;
    height: 100% !important;
}

/* 隐藏终端视图的标题栏 */
.workspace-leaf-content[data-type="terminal-view"] .view-header {
    display: none !important;
}

.workspace-leaf-content[data-type="terminal-view"] .view-content {
    display: flex !important;
    flex-direction: column !important;
    flex: 1 !important;
    min-height: 0 !important;
    height: 100% !important;
    padding: 0 !important;
    overflow: hidden !important;
}

/* 终端视图主容器 */
.terminal-view-container {
    display: flex !important;
    flex-direction: column !important;
    flex: 1 !important;
    min-height: 0 !important;
    height: 100% !important;
    width: 100% !important;
    overflow: hidden !important;
    padding: 0 !important;
    margin: 0 !important;
    /* 默认背景色，当有背景图片时会被覆盖 */
    background-color: var(--background-primary);
}

/* 终端视图主容器 - 有背景图片时 */
.terminal-view-container.has-background-image {
    background-color: transparent !important;
}

/* 终端容器 */
.terminal-container {
    display: flex !important;
    flex-direction: column !important;
    flex: 1 !important;
    min-height: 0 !important;
    overflow: hidden !important;
    position: relative !important;
    width: 100% !important;
    padding: 0 !important;
    margin: 0 !important;
    /* 默认背景色，当有背景图片时会被覆盖 */
    background-color: var(--background-primary);
    /* 确保容器本身不影响子元素透明度 */
    isolation: isolate;
}

/* 终端容器 - 有背景图片时 */
.terminal-container.has-background-image {
    background-color: transparent !important;
}

/* 终端背景图片层 - 独立的背景层，透明度只影响背景 */
.terminal-background-image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 0;
    /* 背景层的透明度通过 opacity 控制，不影响其他层 */
}

/* 终端实例容器 - 文字层保持完全不透明 */
.terminal-instance {
    display: flex !important;
    flex-direction: column !important;
    flex: 1 !important;
    min-height: 0 !important;
    width: 100% !important;
    height: 100% !important;
    position: relative !important;
    z-index: 1;
    /* 确保文字层不受背景透明度影响 */
    background-color: transparent !important;
    opacity: 1 !important;
}

/* ==================== Xterm.js 核心样式 ==================== */

/* Xterm 主容器 */
.terminal-container .xterm,
.terminal-instance .xterm {
    position: relative !important;
    flex: 1 !important;
    min-height: 0 !important;
    height: 100% !important;
    width: 100% !important;
    padding: 4px !important;
    cursor: text;
    outline: none;
    /* 确保终端文字层完全不透明 */
    opacity: 1 !important;
}

/* 有背景图片时，xterm 容器背景透明 */
.terminal-container.has-background-image .xterm {
    background-color: transparent !important;
}

/* Xterm 辅助元素 - 隐藏输入框 */
.xterm-helpers {
    position: absolute;
    top: 0;
    left: 0;
    z-index: -5;
    opacity: 0;
    pointer-events: none;
}

.xterm-helper-textarea {
    position: absolute;
    opacity: 0;
    left: -9999px;
    top: -9999px;
    width: 0;
    height: 0;
    z-index: -5;
    white-space: nowrap;
    overflow: hidden;
    resize: none;
    padding: 0;
    border: 0;
    outline: none;
}

/* Xterm 屏幕 */
.xterm-screen {
    position: relative;
    width: 100%;
    height: 100%;
}

/* 有背景图片时，xterm 屏幕背景透明 */
.terminal-container.has-background-image .xterm-screen {
    background-color: transparent !important;
}

/* Xterm 视口（滚动容器） */
.xterm-viewport {
    overflow-y: auto;
    overflow-x: hidden;
    cursor: default;
    position: absolute;
    right: 0;
    left: 0;
    top: 0;
    bottom: 0;
}

/* 有背景图片时，视口背景透明 */
.terminal-container.has-background-image .xterm-viewport {
    background-color: transparent !important;
}

/* ==================== 光标样式 ==================== */

/* 光标层 - 确保在最上层 */
.xterm-cursor-layer {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 3 !important;
    pointer-events: none;
}

/* 光标 - 块状光标 */
.xterm-cursor {
    position: absolute;
    background-color: var(--text-accent) !important;
    opacity: 1 !important;
    z-index: 3 !important;
    font-family: inherit;
    font-size: inherit;
    line-height: inherit;
}

/* 光标闪烁动画 */
.xterm-cursor.xterm-cursor-blink {
    animation: xterm-cursor-blink 1.2s steps(2, start) infinite;
}

@keyframes xterm-cursor-blink {
    0%, 49% {
        opacity: 1;
    }
    50%, 100% {
        opacity: 0;
    }
}

/* 光标样式变体 */
.xterm-cursor.xterm-cursor-block {
    background-color: var(--text-accent) !important;
    height: 1.2em;
    width: 1ch;
}

.xterm-cursor.xterm-cursor-outline {
    background-color: transparent !important;
    border: 1px solid var(--text-accent) !important;
    box-sizing: border-box;
    height: 1.2em;
    width: 1ch;
}

.xterm-cursor.xterm-cursor-bar {
    background-color: var(--text-accent) !important;
    width: 1px !important;
    height: 1.2em;
}

.xterm-cursor.xterm-cursor-underline {
    background-color: transparent !important;
    border-bottom: 1px solid var(--text-accent) !important;
    height: 1px !important;
    bottom: 0;
    width: 1ch;
}

/* ==================== 文本和渲染层 ==================== */

/* 文本层 */
.xterm-text-layer {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
    color: var(--text-normal);
    font-family: var(--font-monospace);
    font-size: 14px;
    line-height: 1.2;
    contain: strict;
    /* 使用 CSS 变量控制文字透明度，默认完全不透明 */
    opacity: var(--terminal-text-opacity, 1) !important;
}

/* 链接层 */
.xterm-link-layer {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 2;
}

/* 选择层 */
.xterm-selection-layer {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
}

/* 选择文本样式 */
.xterm-selection {
    position: absolute;
    background-color: var(--text-selection) !important;
    opacity: 0.3 !important;
}

/* ==================== Canvas 渲染器样式 ==================== */

.xterm-canvas {
    position: absolute;
    top: 0;
    left: 0;
    /* 使用 CSS 变量控制 Canvas 渲染器的透明度 */
    opacity: var(--terminal-text-opacity, 1) !important;
}

/* 当有背景图片时，Canvas 渲染器也需要透明背景 */
.terminal-container.has-background-image .xterm-canvas,
.terminal-container.has-background-image canvas {
    background-color: transparent !important;
}

/* ==================== 滚动条样式 ==================== */

.xterm-viewport::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}

.xterm-viewport::-webkit-scrollbar-track {
    background: var(--background-secondary);
}

.xterm-viewport::-webkit-scrollbar-thumb {
    background: var(--background-modifier-border);
    border-radius: 5px;
}

.xterm-viewport::-webkit-scrollbar-thumb:hover {
    background: var(--text-muted);
}

.xterm-viewport::-webkit-scrollbar-corner {
    background: var(--background-secondary);
}

/* ==================== 链接样式 ==================== */

.xterm-link {
    cursor: pointer;
    text-decoration: underline;
    color: var(--text-accent);
}

.xterm-link:hover {
    text-decoration: underline;
    color: var(--text-accent-hover);
}

/* ==================== 错误和状态消息 ==================== */

.terminal-error-message {
    padding: 12px;
    margin: 8px;
    background-color: var(--background-modifier-error);
    border: 1px solid var(--background-modifier-error-border);
    border-radius: 4px;
    color: var(--text-error);
    font-family: var(--font-monospace);
    font-size: 13px;
}

.terminal-exit-message {
    padding: 12px;
    margin: 8px;
    background-color: var(--background-secondary);
    border: 1px solid var(--background-modifier-border);
    border-radius: 4px;
    color: var(--text-muted);
    font-family: var(--font-monospace);
    font-size: 13px;
}

/* ==================== 主题兼容性 ==================== */

.theme-dark .terminal-view-container,
.theme-dark .terminal-container {
    background-color: #1e1e1e;
}

/* 有背景图片时，主题背景色不生效 */
.theme-dark .terminal-view-container.has-background-image,
.theme-dark .terminal-container.has-background-image {
    background-color: transparent !important;
}

.theme-dark .xterm-text-layer {
    color: #d4d4d4;
}

.theme-dark .xterm-cursor {
    background-color: #aeafad !important;
}

.theme-light .terminal-view-container,
.theme-light .terminal-container {
    background-color: #ffffff;
}

/* 有背景图片时，主题背景色不生效 */
.theme-light .terminal-view-container.has-background-image,
.theme-light .terminal-container.has-background-image {
    background-color: transparent !important;
}

.theme-light .xterm-text-layer {
    color: #000000;
}

.theme-light .xterm-cursor {
    background-color: #000000 !important;
}

/* ==================== 焦点样式 ==================== */

.xterm:focus {
    outline: none;
}

.xterm.focus .xterm-cursor {
    opacity: 1 !important;
}

.xterm:not(.focus) .xterm-cursor {
    opacity: 0.5;
}

/* ==================== 响应式设计 ==================== */

@media (max-width: 768px) {
    .terminal-container {
        padding: 0;
    }
    
    .terminal-error-message,
    .terminal-exit-message {
        margin: 4px;
        padding: 8px;
        font-size: 12px;
    }
    
    .xterm-text-layer {
        font-size: 12px;
    }
}

/* ==================== 性能优化 ==================== */

.xterm-rows {
    will-change: transform;
}

.xterm-cursor-layer,
.xterm-text-layer,
.xterm-selection-layer,
.xterm-link-layer {
    contain: strict;
}

/* ==================== 可折叠区块样式 ==================== */

/* 可折叠区块包装容器 */
.collapsible-section-wrapper {
    margin-bottom: 16px;
    border: 1px solid var(--background-modifier-border);
    border-radius: 8px;
    overflow: hidden;
    background-color: var(--background-primary);
    transition: all 0.2s ease;
}

.collapsible-section-wrapper:hover {
    border-color: var(--background-modifier-border-hover);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

/* 可折叠区块标题 */
.collapsible-section-header {
    display: flex;
    align-items: center;
    padding: 12px 16px;
    cursor: pointer;
    user-select: none;
    background-color: var(--background-secondary);
    transition: all 0.2s ease;
    border-bottom: 1px solid transparent;
}

.collapsible-section-header:hover {
    background-color: var(--background-modifier-hover);
}

.collapsible-section-header.is-expanded {
    border-bottom-color: var(--background-modifier-border);
}

/* 标题信息区域 */
.collapsible-section-header .setting-item-info {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 4px;
}

/* 标题名称 */
.collapsible-section-header .setting-item-name {
    display: flex;
    align-items: center;
    font-weight: 500;
    color: var(--text-normal);
    font-size: 14px;
}

/* 标题描述 */
.collapsible-section-header .setting-item-description {
    color: var(--text-muted);
    font-size: 12px;
    line-height: 1.4;
}

/* 折叠图标 */
.collapsible-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    margin-right: 8px;
    color: var(--text-muted);
    transition: transform 0.2s ease, color 0.2s ease;
}

.collapsible-section-header:hover .collapsible-icon {
    color: var(--text-normal);
}

.collapsible-section-header.is-expanded .collapsible-icon {
    color: var(--interactive-accent);
}

/* 可折叠内容区域 */
.collapsible-content {
    padding: 0;
    overflow: hidden;
    transition: all 0.3s ease;
}

/* 折叠内容的设置项 */
.collapsible-content .setting-item {
    padding: 12px 16px;
    margin: 0;
    border-bottom: 1px solid var(--background-modifier-border);
    background-color: var(--background-primary);
    transition: background-color 0.2s ease;
}

.collapsible-content .setting-item:last-child {
    border-bottom: none;
}

.collapsible-content .setting-item:hover {
    background-color: var(--background-secondary-alt);
}

/* 折叠内容设置项的名称 */
.collapsible-content .setting-item .setting-item-name {
    font-size: 13px;
    font-weight: 500;
}

/* 折叠内容设置项的描述 */
.collapsible-content .setting-item .setting-item-description {
    font-size: 12px;
    color: var(--text-muted);
    line-height: 1.4;
}

/* 响应式优化 */
@media screen and (max-width: 768px) {
    .collapsible-section-header {
        padding: 10px 12px;
    }
    
    .collapsible-content .setting-item {
        padding: 10px 12px;
    }
    
    .collapsible-section-header .setting-item-name {
        font-size: 13px;
    }
    
    .collapsible-section-header .setting-item-description {
        font-size: 11px;
    }
}
